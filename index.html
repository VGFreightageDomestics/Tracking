<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Track Your Package | VG Freightage Domestic</title>
    
    <!-- PWA / MOBILE APP SETTINGS -->
    <meta name="theme-color" content="#001f60">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* COLORS BASED ON YOUR LOGO */
            --vg-blue: #001f60;   /* Deep Blue */
            --vg-green: #00c853;  /* Bright Green */
            --vg-red: #d32f2f;    /* Accent Red */
            --bg-light: #f4f6f9;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-light);
            color: #333;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* 1. HERO SECTION (Blue Background) */
        .hero-section {
            background: linear-gradient(135deg, var(--vg-blue) 0%, #000c24 100%);
            min-height: 320px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 20px 80px 20px; /* Extra padding bottom for overlap */
            text-align: center;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .logo-img {
            max-width: 250px;
            width: 80%;
            height: auto;
            margin-bottom: 10px;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
        }

        /* 2. FLOATING SEARCH CARD */
        .search-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 500px;
            margin: -60px auto 0; /* Floats over the blue part */
            z-index: 100;
            position: relative;
        }

        /* INPUT & BUTTON STYLING */
        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--vg-blue);
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 15px; /* Space between input and button */
            transition: 0.3s;
        }
        .search-input:focus {
            border-color: var(--vg-blue);
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 31, 96, 0.1);
        }

        .btn-track {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, #ff8f00, #ff6f00);
            color: white;
            font-weight: 800;
            font-size: 1.1rem;
            border: none;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 5px 15px rgba(255, 111, 0, 0.3);
        }
        .btn-track:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 111, 0, 0.4);
        }
        .btn-track:disabled {
            background: #ccc;
            transform: none;
        }

        /* 3. RESULT AREA */
        .result-container {
            max-width: 600px;
            margin: 30px auto 50px;
            padding: 0 15px;
            display: none; /* Hidden by default */
            animation: slideUp 0.5s ease;
        }

        /* CARD STYLES */
        .info-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-top: 5px solid var(--vg-blue);
        }

        .waybill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .badge-status {
            font-size: 0.9rem;
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .route-visual {
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-align: center;
            margin: 20px 0;
        }
        .route-point h5 { font-weight: 700; color: var(--vg-blue); margin: 0; }
        .route-point p { font-size: 0.8rem; color: #777; margin: 0; }
        .route-arrow { color: var(--vg-green); font-size: 1.5rem; }

        /* TIMELINE STYLES */
        .timeline-box {
            padding-left: 20px;
        }
        .timeline-item {
            position: relative;
            padding-left: 30px;
            padding-bottom: 30px;
            border-left: 2px solid #e0e0e0;
        }
        .timeline-item:last-child { border-left: none; padding-bottom: 0; }
        
        .timeline-dot {
            position: absolute;
            left: -9px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #ccc;
        }
        
        /* Active (Latest) State */
        .timeline-item.active .timeline-dot {
            background: var(--vg-green);
            border-color: var(--vg-green);
            box-shadow: 0 0 0 4px rgba(0, 200, 83, 0.2);
        }
        .timeline-item.active h6 { color: var(--vg-green); }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* UTILS */
        .bg-success-subtle { background-color: #d1e7dd; color: #0f5132; }
        .bg-warning-subtle { background-color: #fff3cd; color: #664d03; }
        .bg-primary-subtle { background-color: #cfe2ff; color: #084298; }
        .bg-secondary-subtle { background-color: #e2e3e5; color: #41464b; }

    </style>
</head>
<body>

    <!-- HERO SECTION -->
    <div class="hero-section">
        <!-- Logo Image -->
        <img src="logo.png" alt="VG Freightage" class="logo-img" onerror="this.style.display='none'">
        
        <!-- Fallback Text (kung sakaling hindi mag-load ang logo) -->
        <div id="textLogo" style="display:none;">
            <h2 class="fw-bold m-0">VG FREIGHTAGE</h2>
            <small>DOMESTIC SERVICES</small>
        </div>
        
        <p class="mt-2 text-white-50" style="font-size: 0.9rem;">Bridge to Your Logistics Success</p>
    </div>

    <!-- SEARCH CARD -->
    <div class="search-card">
        <label class="fw-bold text-muted small mb-2 d-block text-start">
            <i class="fas fa-barcode me-1"></i> TRACKING NUMBER
        </label>
        
        <!-- INPUT -->
        <input type="text" id="trackInput" class="search-input" placeholder="e.g. VG-888888">
        
        <!-- BUTTON -->
        <button class="btn-track" onclick="trackParcel()">
            <i class="fas fa-search me-2"></i> TRACK NOW
        </button>
        
        <p id="errorMsg" class="text-danger small mt-3 fw-bold text-center mb-0" style="display:none;"></p>
    </div>

    <!-- RESULTS SECTION -->
    <div id="resultArea" class="result-container">
        
        <!-- WAYBILL STATUS CARD -->
        <div class="info-card">
            <div class="waybill-header">
                <div>
                    <small class="text-muted d-block fw-bold" style="font-size:0.7rem;">WAYBILL ID</small>
                    <h3 class="fw-bold m-0 text-dark" id="resWaybill">VG-XXXXXX</h3>
                </div>
                <div>
                    <span id="resStatusBadge" class="badge-status bg-secondary-subtle">...</span>
                </div>
            </div>

            <!-- ROUTE -->
            <div class="route-visual">
                <div class="route-point">
                    <small class="text-muted fw-bold">ORIGIN</small>
                    <h5 id="resOriginCity">...</h5>
                    <p id="resOriginAddr">...</p>
                </div>
                <div class="route-arrow">
                    <i class="fas fa-shipping-fast"></i>
                </div>
                <div class="route-point">
                    <small class="text-muted fw-bold">DESTINATION</small>
                    <h5 id="resDestCity">...</h5>
                    <p id="resDestAddr">...</p>
                </div>
            </div>

            <hr class="text-muted opacity-25">
            
            <!-- SHIPPER / CONSIGNEE / DETAILS -->
            <div class="row text-center g-3" style="font-size: 0.85rem;">
                <div class="col-6 text-start border-end">
                    <small class="text-muted fw-bold d-block">SENDER</small>
                    <span class="fw-bold text-dark" id="resShipper">...</span>
                </div>
                <div class="col-6 text-end">
                    <small class="text-muted fw-bold d-block">RECEIVER</small>
                    <span class="fw-bold text-dark" id="resConsignee">...</span>
                </div>
                <div class="col-6 text-start border-end border-top pt-2">
                    <small class="text-muted fw-bold d-block">ITEMS</small>
                    <span class="fw-bold text-dark" id="resQty">0</span>
                </div>
                <div class="col-6 text-end border-top pt-2">
                    <small class="text-muted fw-bold d-block">WEIGHT</small>
                    <span class="fw-bold text-dark" id="resWeight">0kg</span>
                </div>
            </div>
        </div>

        <!-- HISTORY TIMELINE -->
        <div class="info-card">
            <h6 class="fw-bold mb-4 text-uppercase" style="color:var(--vg-blue); letter-spacing:1px;">
                <i class="fas fa-history me-2"></i> Tracking History
            </h6>
            <div id="historyContainer" class="timeline-box">
                <!-- Javascript will insert history here -->
            </div>
        </div>

        <div class="text-center mt-4 mb-5">
            <small class="text-muted">&copy; 2026 VG Freightage Domestic</small>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // *** CONFIG (VG-CARGO-SYSTEM-3) ***
        const firebaseConfig = {
            apiKey: "AIzaSyCrDEUr1O5krXFHEB2hafLXuEumEcoSTxM",
            authDomain: "vg-cargo-system-3.firebaseapp.com",
            projectId: "vg-cargo-system-3",
            storageBucket: "vg-cargo-system-3.firebasestorage.app",
            messagingSenderId: "819520192535",
            appId: "1:819520192535:web:8e42b272500f9b60e19c52"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Fallback if logo fails
        document.querySelector('.logo-img').onerror = function() {
            this.style.display = 'none';
            document.getElementById('textLogo').style.display = 'block';
        };

        window.trackParcel = async function() {
            const input = document.getElementById('trackInput');
            const wb = input.value.trim().toUpperCase();
            const btn = document.querySelector('.btn-track');
            const resultArea = document.getElementById('resultArea');
            const errorMsg = document.getElementById('errorMsg');

            // HIDE KEYBOARD
            input.blur();

            if(!wb) { 
                input.focus(); 
                input.style.borderColor = "red";
                setTimeout(() => input.style.borderColor = "#e0e0e0", 2000);
                return; 
            }

            // LOADING STATE
            const originalBtnText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> SEARCHING...';
            btn.disabled = true;
            resultArea.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                const docRef = doc(db, "parcels", wb);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    // 1. POPULATE HEADER
                    document.getElementById('resWaybill').innerText = data.waybill;
                    const status = data.currentStatus || "Unknown";
                    
                    // STATUS BADGE COLOR
                    const badge = document.getElementById('resStatusBadge');
                    badge.innerText = status;
                    badge.className = `badge-status ${getStatusColor(status)}`;

                    // 2. POPULATE DETAILS
                    document.getElementById('resShipper').innerText = data.shipper.name;
                    document.getElementById('resOriginCity').innerText = extractCity(data.shipper.addr);
                    document.getElementById('resOriginAddr').innerText = data.shipper.addr;

                    document.getElementById('resConsignee').innerText = data.consignee.name;
                    document.getElementById('resDestCity').innerText = extractCity(data.consignee.addr);
                    document.getElementById('resDestAddr').innerText = data.consignee.addr;
                    
                    document.getElementById('resQty').innerText = data.details.qty;
                    document.getElementById('resWeight').innerText = data.details.weight;

                    // 3. POPULATE TIMELINE
                    let historyHTML = "";
                    const sortedHistory = data.history ? data.history.reverse() : [];
                    
                    sortedHistory.forEach((h, index) => {
                        const isActive = index === 0 ? 'active' : '';
                        const timeString = h.time || ""; 
                        
                        historyHTML += `
                        <div class="timeline-item ${isActive}">
                            <div class="timeline-dot"></div>
                            <h6 class="fw-bold mb-1">${h.status}</h6>
                            <p class="small text-muted mb-1"><i class="fas fa-map-marker-alt me-1"></i> ${h.location}</p>
                            <small class="text-muted" style="font-size:0.75rem">${timeString}</small>
                        </div>`;
                    });

                    document.getElementById('historyContainer').innerHTML = historyHTML || "<p class='text-muted ps-3'>No history available.</p>";
                    
                    // SHOW RESULT
                    resultArea.style.display = 'block';

                    // Scroll to result slightly delayed for animation
                    setTimeout(() => {
                        const yOffset = -20; 
                        const y = resultArea.getBoundingClientRect().top + window.pageYOffset + yOffset;
                        window.scrollTo({top: y, behavior: 'smooth'});
                    }, 100);

                } else {
                    errorMsg.innerHTML = "<i class='fas fa-exclamation-circle'></i> Tracking number not found.<br>Please check properly.";
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                console.error(error);
                errorMsg.innerText = "Connection Error. Please check your internet.";
                errorMsg.style.display = 'block';
            }

            // RESET BUTTON
            btn.innerHTML = originalBtnText;
            btn.disabled = false;
        }

        // Helper to guess City from Address (Simple Split)
        function extractCity(addr) {
            if(!addr) return "Origin";
            const parts = addr.split(',');
            // Return the last part usually city/province, or the whole string if short
            return parts.length > 1 ? parts[parts.length - 1].trim() : addr;
        }

        function getStatusColor(status) {
            status = status.toUpperCase();
            if(status.includes("DELIVERED")) return "bg-success-subtle text-success";
            if(status.includes("PENDING") || status.includes("ACCEPTED")) return "bg-secondary-subtle text-dark";
            if(status.includes("TRANSIT") || status.includes("BOARD") || status.includes("DEPARTED")) return "bg-primary-subtle text-primary";
            if(status.includes("ARRIVED") || status.includes("HUB")) return "bg-warning-subtle text-dark";
            return "bg-secondary-subtle";
        }
    </script>
</body>
</html>
