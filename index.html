<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Track Your Package | VG Freightage Domestic</title>
    
    <!-- PWA SETTINGS -->
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --vg-blue: #001f60;
            --vg-green: #00c853;
            --vg-dark: #0f172a;
            --bg-light: #f3f4f6;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-light);
            color: var(--vg-dark);
            overflow-x: hidden;
        }

        /* 1. TOP NAVBAR (Para malinis ang Logo) */
        .app-header {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
            text-align: center;
        }

        .header-logo {
            height: 60px; /* Adjust height para bumagay */
            width: auto;
            object-fit: contain;
        }

        /* 2. HERO SECTION */
        .hero-section {
            background: linear-gradient(160deg, var(--vg-blue) 0%, #000c24 100%);
            min-height: 280px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding-bottom: 70px;
            border-radius: 0 0 40px 40px;
            position: relative;
        }
        
        /* Background decorative icon */
        .hero-bg-icon {
            font-size: 8rem;
            color: white;
            opacity: 0.05;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* 3. SEARCH CARD (Floating) */
        .search-container {
            width: 90%;
            max-width: 500px;
            margin: -60px auto 30px; /* Float effect */
            position: relative;
            z-index: 10;
        }

        .search-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,31,96,0.15);
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--vg-blue);
            text-transform: uppercase;
            text-align: center;
            letter-spacing: 1px;
            transition: 0.3s;
            background: #f8fafc;
        }
        .search-input:focus {
            background: white;
            border-color: var(--vg-blue);
            outline: none;
        }

        .btn-track {
            width: 100%;
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(90deg, #ff8f00, #ff6f00);
            color: white;
            font-weight: 800;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            letter-spacing: 1px;
            box-shadow: 0 8px 20px rgba(255, 111, 0, 0.25);
            transition: 0.3s;
        }
        .btn-track:active { transform: scale(0.98); }

        /* 4. RESULT CARD */
        .result-area {
            display: none;
            width: 90%;
            max-width: 600px;
            margin: 0 auto 50px;
            animation: slideUp 0.5s ease;
        }

        .status-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border-top: 6px solid var(--vg-green);
        }

        .status-header {
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* PROGRESS STEPPER (Visual) */
        .stepper {
            display: flex;
            justify-content: space-between;
            padding: 20px 30px;
            position: relative;
        }
        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            opacity: 0.5;
        }
        .step.active { opacity: 1; color: var(--vg-green); }
        .step-icon {
            font-size: 1.5rem;
            background: white;
            margin-bottom: 5px;
        }
        .step-line {
            position: absolute;
            top: 35px;
            left: 40px;
            right: 40px;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }

        .info-grid {
            padding: 20px;
        }
        
        .timeline-section {
            padding: 0 20px 20px;
        }
        .timeline-item {
            position: relative;
            padding-left: 35px;
            padding-bottom: 25px;
            border-left: 2px dashed #cbd5e1;
        }
        .timeline-item:last-child { border: none; padding-bottom: 0; }
        .t-icon {
            position: absolute;
            left: -11px;
            top: 0;
            background: #cbd5e1;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        .timeline-item.active .t-icon {
            background: var(--vg-green);
            box-shadow: 0 0 0 4px rgba(0, 200, 83, 0.2);
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <!-- 1. HEADER (White Bar for Logo) -->
    <header class="app-header">
        <img src="logo.png" alt="VG Freightage" class="header-logo" onerror="this.style.display='none'; document.getElementById('txtLogo').style.display='block'">
        <div id="txtLogo" style="display:none; color:var(--vg-blue); font-weight:800;">VG FREIGHTAGE</div>
    </header>

    <!-- 2. HERO (Blue Gradient) -->
    <div class="hero-section">
        <i class="fas fa-box-open hero-bg-icon"></i> <!-- Decorative BG -->
        <h2 class="fw-bold mb-1">Track Your Parcel</h2>
        <p class="text-white-50 small">Real-time Domestic Logistics Tracking</p>
    </div>

    <!-- 3. SEARCH CARD -->
    <div class="search-container">
        <div class="search-card">
            <label class="small fw-bold text-muted mb-2 ms-1">WAYBILL NUMBER</label>
            <input type="text" id="trackInput" class="search-input" placeholder="VG-XXXXXX">
            <button class="btn-track" onclick="trackParcel()">TRACK NOW</button>
            <p id="errorMsg" class="text-danger small fw-bold text-center mt-3 mb-0" style="display:none;"></p>
        </div>
    </div>

    <!-- 4. RESULT AREA -->
    <div id="resultArea" class="result-area">
        <div class="status-card">
            
            <!-- Header -->
            <div class="status-header">
                <div>
                    <small class="text-muted fw-bold" style="font-size:0.7rem">WAYBILL ID</small>
                    <h4 class="fw-bold m-0 text-dark" id="resWaybill">...</h4>
                </div>
                <span class="badge bg-warning text-dark" id="resStatusBadge">...</span>
            </div>

            <!-- Visual Progress -->
            <div class="position-relative">
                <div class="step-line"></div>
                <div class="stepper">
                    <div class="step active">
                        <div class="step-icon"><i class="fas fa-box"></i></div>
                        <small class="fw-bold" style="font-size:0.7rem">Posted</small>
                    </div>
                    <div class="step" id="step-transit">
                        <div class="step-icon"><i class="fas fa-shipping-fast"></i></div>
                        <small class="fw-bold" style="font-size:0.7rem">In Transit</small>
                    </div>
                    <div class="step" id="step-delivered">
                        <div class="step-icon"><i class="fas fa-home"></i></div>
                        <small class="fw-bold" style="font-size:0.7rem">Delivered</small>
                    </div>
                </div>
            </div>

            <hr class="m-0 border-light">

            <!-- Details -->
            <div class="info-grid">
                <div class="row g-3">
                    <div class="col-6">
                        <small class="text-muted fw-bold d-block" style="font-size:0.7rem">ORIGIN</small>
                        <span class="fw-bold text-dark" id="resOrigin">...</span>
                    </div>
                    <div class="col-6 text-end">
                        <small class="text-muted fw-bold d-block" style="font-size:0.7rem">DESTINATION</small>
                        <span class="fw-bold text-dark" id="resDest">...</span>
                    </div>
                    <div class="col-6">
                        <small class="text-muted fw-bold d-block" style="font-size:0.7rem">SENDER</small>
                        <span class="fw-bold text-dark" id="resShipper">...</span>
                    </div>
                    <div class="col-6 text-end">
                        <small class="text-muted fw-bold d-block" style="font-size:0.7rem">RECEIVER</small>
                        <span class="fw-bold text-dark" id="resConsignee">...</span>
                    </div>
                </div>
            </div>

            <!-- Timeline -->
            <div class="bg-light p-3">
                <h6 class="fw-bold small text-muted mb-3 ms-2">TIMELINE ACTIVITY</h6>
                <div id="historyContainer" class="timeline-section"></div>
            </div>

        </div>
        
        <div class="text-center mt-4 text-muted small">
            &copy; 2026 VG Freightage Domestic
        </div>
    </div>

    <!-- JS LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCrDEUr1O5krXFHEB2hafLXuEumEcoSTxM",
            authDomain: "vg-cargo-system-3.firebaseapp.com",
            projectId: "vg-cargo-system-3",
            storageBucket: "vg-cargo-system-3.firebasestorage.app",
            messagingSenderId: "819520192535",
            appId: "1:819520192535:web:8e42b272500f9b60e19c52"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.trackParcel = async function() {
            const input = document.getElementById('trackInput');
            const wb = input.value.trim().toUpperCase();
            const btn = document.querySelector('.btn-track');
            const resultArea = document.getElementById('resultArea');
            const errorMsg = document.getElementById('errorMsg');

            input.blur(); // Hide keyboard

            if(!wb) { input.focus(); return; }

            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> SEARCHING...';
            btn.disabled = true;
            resultArea.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                const docRef = doc(db, "parcels", wb);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    document.getElementById('resWaybill').innerText = data.waybill;
                    const status = data.currentStatus || "Unknown";
                    
                    // Update Badge
                    const badge = document.getElementById('resStatusBadge');
                    badge.innerText = status;
                    badge.className = `badge ${getStatusColor(status)}`;

                    // Update Stepper Visuals
                    updateStepper(status);

                    // Details
                    document.getElementById('resShipper').innerText = data.shipper.name.split(' ')[0]; // First name only for brevity
                    document.getElementById('resOrigin').innerText = extractCity(data.shipper.addr);
                    document.getElementById('resConsignee').innerText = data.consignee.name.split(' ')[0];
                    document.getElementById('resDest').innerText = extractCity(data.consignee.addr);

                    // Timeline
                    let historyHTML = "";
                    const sortedHistory = data.history ? data.history.reverse() : [];
                    sortedHistory.forEach((h, index) => {
                        const isActive = index === 0 ? 'active' : '';
                        historyHTML += `
                        <div class="timeline-item ${isActive}">
                            <div class="t-icon"><i class="fas fa-check"></i></div>
                            <h6 class="fw-bold mb-1 small text-dark">${h.status}</h6>
                            <p class="small text-muted mb-0"><i class="fas fa-map-pin me-1"></i> ${h.location}</p>
                            <small class="text-muted" style="font-size:0.65rem">${h.time}</small>
                        </div>`;
                    });

                    document.getElementById('historyContainer').innerHTML = historyHTML || "<p>No history.</p>";
                    resultArea.style.display = 'block';

                    setTimeout(() => {
                        resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);

                } else {
                    errorMsg.innerText = "Tracking number not found.";
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                console.error(error);
                errorMsg.innerText = "Connection error. Try again.";
                errorMsg.style.display = 'block';
            }

            btn.innerHTML = 'TRACK NOW';
            btn.disabled = false;
        }

        function extractCity(addr) {
            if(!addr) return "Origin";
            const parts = addr.split(',');
            return parts.length > 1 ? parts[parts.length - 1].trim() : addr;
        }

        function getStatusColor(status) {
            status = status.toUpperCase();
            if(status.includes("DELIVERED")) return "bg-success";
            if(status.includes("TRANSIT") || status.includes("BOARD")) return "bg-primary";
            return "bg-secondary";
        }

        function updateStepper(status) {
            status = status.toUpperCase();
            const sTransit = document.getElementById('step-transit');
            const sDelivered = document.getElementById('step-delivered');

            sTransit.className = 'step'; 
            sDelivered.className = 'step';

            if(status.includes("TRANSIT") || status.includes("BOARD") || status.includes("ARRIVED")) {
                sTransit.classList.add('active');
            }
            if(status.includes("DELIVERED")) {
                sTransit.classList.add('active');
                sDelivered.classList.add('active');
            }
        }
    </script>
</body>
</html>
